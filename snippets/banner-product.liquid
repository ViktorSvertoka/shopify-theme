<script src="{{ 'banner-product.js' | asset_url }}" defer></script>

{%- liquid
  assign banner_product = nil
  
  if product
    assign banner_product = product
  elsif handle
    assign banner_product = all_products[handle]
  endif
-%}

{%- if banner_product == nil or banner_product == blank -%}
  <div class="text-dark dark:text-darkInverse p-4">
    Product not found
  </div>
{%- endif -%}

<div class="banner-product flex items-start flex-col xl:flex-row gap-6 relative w-full max-w-[468px] xl:max-w-none">
  <div class="banner-product__gallery max-w-[568px] xl:max-w-[650px] w-full flex items-center flex-col-reverse xl:flex-row xl:items-start xl:justify-between gap-6 mx-auto xl:mx-0"
       data-all-images='[
         {%- if banner_product.images != blank -%}
           {%- for image in banner_product.images -%}
             "{{ image | image_url: width: 800 }}"{% unless forloop.last %},{% endunless %}
           {%- endfor -%}
         {%- else -%}
           "{{ 'product-placeholder.jpg' | asset_url }}"
         {%- endif -%}
       ]'>
    <div class="banner-product__thumbs m-0 w-full px-[15px] xl:px-0 xl:w-[88px] transition-opacity duration-300 opacity-100 flex xl:flex-col flex-wrap gap-4 xl:gap-0"></div>

    <div class="banner-product__main aspect-square m-0 rounded-base overflow-hidden"></div>
  </div>

  <div class="banner-product__content max-w-full sm:max-w-[612px] w-full px-4 sm:px-0">
    <h2 class="banner-product__title text-2xl sm:text-[30px] leading-[1.3] sm:leading-[1.2] font-normal m-0 mb-2 text-dark dark:text-darkInverse">
      {{ banner_product.title | escape }}
    </h2>

    {%- if banner_product.tags contains "Highly Rated" -%}
      <p class="banner-product__badge inline-flex items-center justify-center gap-1.5 px-2 py-1 text-dark dark:text-darkInverse bg-white dark:bg-whiteInverse rounded-base text-sm m-0 absolute top-4 left-4 sm:left-[130px] z-10">
        <img 
          src="{{ 'icon-star.svg' | asset_url }}" 
          alt="Star" 
          class="badge__icon block"
          width="16"
          height="16"
        >
        Highly Rated
      </p>
    {%- endif -%}

    {%- if banner_product.price != blank -%}
      <div class="banner-product__price text-grayDefault dark:text-grayDark mb-4">
        {%- if banner_product.compare_at_price > banner_product.price -%}
          <span class="price price--sale text-dark dark:text-darkInverse font-semibold">{{ banner_product.price | money }}</span>
          <span class="price price--old line-through text-red-600 ml-2">{{ banner_product.compare_at_price | money }}</span>
        {%- else -%}
          <span class="price">{{ banner_product.price | money }}</span>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- assign color_option_index = nil -%}
    {%- for option in banner_product.options_with_values -%}
      {%- assign opt_name = option.name | downcase -%}
      {%- if opt_name contains 'color' or opt_name contains 'colour' or opt_name contains 'колір' -%}
        {%- assign color_option_index = forloop.index0 -%}
      {%- endif -%}
    {%- endfor -%}

    {%- if color_option_index != nil -%}
      <div class="banner-product__colors flex gap-2 mb-4">
        {%- assign images_per_color = 5 -%}
        {%- assign color_index = 0 -%}
        {%- for variant in banner_product.variants -%}
          {%- if variant.featured_image -%}
            {%- assign start_index = color_index | times: images_per_color -%}
            {%- assign end_index = start_index | plus: images_per_color | minus: 1 -%}
            <button 
              type="button"
              class="banner-product__color-btn w-16 h-[68px] border border-stroke dark:border-strokeDark rounded-base overflow-hidden bg-transparent p-0 cursor-pointer hover:border-dark dark:hover:border-darkInverse transition-colors"
              data-start="{{ start_index }}"
              data-end="{{ end_index }}"
              data-price="{{ variant.price | money }}"
              data-compare="{{ variant.compare_at_price | money }}"
              data-available="{{ variant.available }}"
              data-qty="{{ variant.inventory_quantity }}"
            >
              {{ variant.featured_image | image_url: width: 60 | image_tag: alt: variant.featured_image.alt | default: banner_product.title | default: 'Product image', class: 'w-full h-full object-cover block' }}
            </button>
            {%- assign color_index = color_index | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
      </div>

      <div 
        class="banner-product__stock text-sm leading-[1.4] mb-[30px] text-dark dark:text-darkInverse"
        data-not-available="{{ 'products.product.banner.not_available' | t: default: 'Not available' }}"
        data-available-template="{{ 'products.product.banner.available_with_count' | t: count: '__COUNT__', default: 'Available: __COUNT__' }}"
      >
        {{ 'products.product.banner.select_color' | t: default: 'Choose a color' }}
      </div>
    {%- endif -%}

    <p class="banner-product__select-size text-dark dark:text-darkInverse mb-2">Select Size:</p>
    <div class="banner-product__sizes flex flex-wrap justify-around gap-2 mb-4">
      {%- assign sizes = banner_product.variants | map: 'option2' | uniq -%}
      {%- for size in sizes -%}
        {%- assign variant = banner_product.variants | where: 'option2', size | first -%}
        {%- if variant -%}
          <button 
            type="button" 
            class="banner-product__size-btn px-3 py-3 text-sm leading-[1.4] bg-white dark:bg-whiteInverse text-dark dark:text-darkInverse border border-stroke dark:border-strokeDark rounded-base cursor-pointer w-[136px] hover:border-grayLight dark:hover:border-grayLightDark transition-colors"
            data-variant-id="{{ variant.id }}"
            data-available="{{ variant.available }}"
          >
            EU {{ size }}
          </button>
        {%- endif -%}
      {%- endfor -%}
    </div>

    {%- assign first_variant = banner_product.variants.first -%}
    <a 
      href="/cart/add?id={{ first_variant.id }}&quantity=1" 
      class="banner-product__add-to-cart block text-center no-underline w-full px-4 py-4 bg-dark dark:bg-darkInverse text-white dark:text-whiteInverse rounded-base mb-4 cursor-pointer hover:bg-grayDefault dark:hover:bg-grayDark transition-colors"
    >
      Add To Bag
    </a>

    <div class="banner-product__description text-sm leading-normal text-grayDefault dark:text-grayDark">
      {{ banner_product.description | truncatewords: 30, '...' }}
    </div>
  </div>
</div>